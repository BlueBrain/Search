<html>
  <head>

  </head>
  <body>
    <!-- <div >
      <p style="color: red">Outboud connection</p>
      <p style="color: blue">Inbound connection</p>
    </div> -->
    
    <label for="items-ids">Please select an item</label>
    <input id="item-ids" required list="itemid-list" />
    <datalist id="itemid-list">
    </datalist>

    <div style="display: flex;">
      <div id="graph-host"></div>
      <div id='info' style="width: 500px; font-size: 1.2em; font-family: sans-serif;">info</div>
    </div>

    

    <script>

      var options = {}
      var dataset  = JSON.parse(`[
  {
    "data": {
      "id": "hyjojnnn"
    },
    "style": {
      "label": "hyjojnnn",
      "width": 30,
      "height": 30,
      "background-color": "purple",
      "font-size": "2px",
      "color": "black"
    }
  },
  {
    "data": {
      "id": "khrjjtpg"
    },
    "style": {
      "label": "khrjjtpg",
      "width": 30,
      "height": 30,
      "background-color": "brown",
      "font-size": "2px",
      "color": "black"
    }
  },
  {
    "data": {
      "id": "rquqhgdy"
    },
    "style": {
      "label": "rquqhgdy",
      "width": 30,
      "height": 30,
      "background-color": "#00aade",
      "font-size": "2px",
      "color": "black"
    }
  },
  {
    "data": {
      "id": "bxntzeti"
    },
    "style": {
      "label": "bxntzeti",
      "width": 30,
      "height": 30,
      "background-color": "#8912f9",
      "font-size": "2px",
      "color": "black"
    }
  },
  {
    "data": {
      "id": "yqluvvlb"
    },
    "style": {
      "label": "yqluvvlb",
      "width": 30,
      "height": 30,
      "background-color": "pink",
      "font-size": "2px",
      "color": "black"
    }
  },
  {
    "data": {
      "id": "bqbkmsep"
    },
    "style": {
      "label": "bqbkmsep",
      "width": 30,
      "height": 30,
      "background-color": "orange",
      "font-size": "2px",
      "color": "black"
    }
  },
  {
    "data": {
      "id": "frkbfvrl"
    },
    "style": {
      "label": "frkbfvrl",
      "width": 30,
      "height": 30,
      "background-color": "green",
      "font-size": "2px",
      "color": "black"
    }
  },
  {
    "data": {
      "id": "hmujwccb"
    },
    "style": {
      "label": "hmujwccb",
      "width": 30,
      "height": 30,
      "background-color": "#009955",
      "font-size": "2px",
      "color": "black"
    }
  },
  {
    "data": {
      "id": "mjgwivhf"
    },
    "style": {
      "label": "mjgwivhf",
      "width": 30,
      "height": 30,
      "background-color": "#782087",
      "font-size": "2px",
      "color": "black"
    }
  },
  {
    "data": {
      "id": "bhsrgota"
    },
    "style": {
      "label": "bhsrgota",
      "width": 30,
      "height": 30,
      "background-color": "#338811",
      "font-size": "2px",
      "color": "black"
    }
  },
  {
    "data": {
      "id": "bhsrgota_hyjojnnn",
      "source": "bhsrgota",
      "target": "hyjojnnn"
    },
    "style": {
      "label": "",
      "font-size": "10px",
      "width": 1,
      "color": "black",
      "line-color": "pink",
      "line-style": "solid",
      "curve-style": "bezier",
      "target-arrow-shape": "triangle",
      "target-arrow-color": "pink",
      "arrow-scale": 0.5
    }
  },
  {
    "data": {
      "id": "yqluvvlb_bxntzeti",
      "source": "yqluvvlb",
      "target": "bxntzeti"
    },
    "style": {
      "label": "",
      "font-size": "10px",
      "width": 1,
      "color": "black",
      "line-color": "pink",
      "line-style": "solid",
      "curve-style": "bezier",
      "target-arrow-shape": "triangle",
      "target-arrow-color": "pink",
      "arrow-scale": 0.5
    }
  },
  {
    "data": {
      "id": "bhsrgota_khrjjtpg",
      "source": "bhsrgota",
      "target": "khrjjtpg"
    },
    "style": {
      "label": "",
      "font-size": "10px",
      "width": 1,
      "color": "black",
      "line-color": "pink",
      "line-style": "solid",
      "curve-style": "bezier",
      "target-arrow-shape": "triangle",
      "target-arrow-color": "pink",
      "arrow-scale": 0.5
    }
  },
  {
    "data": {
      "id": "hyjojnnn_bhsrgota",
      "source": "hyjojnnn",
      "target": "bhsrgota"
    },
    "style": {
      "label": "",
      "font-size": "10px",
      "width": 1,
      "color": "black",
      "line-color": "pink",
      "line-style": "solid",
      "curve-style": "bezier",
      "target-arrow-shape": "triangle",
      "target-arrow-color": "pink",
      "arrow-scale": 0.5
    }
  },
  {
    "data": {
      "id": "bqbkmsep_khrjjtpg",
      "source": "bqbkmsep",
      "target": "khrjjtpg"
    },
    "style": {
      "label": "",
      "font-size": "10px",
      "width": 1,
      "color": "black",
      "line-color": "pink",
      "line-style": "solid",
      "curve-style": "bezier",
      "target-arrow-shape": "triangle",
      "target-arrow-color": "pink",
      "arrow-scale": 0.5
    }
  },
  {
    "data": {
      "id": "frkbfvrl_rquqhgdy",
      "source": "frkbfvrl",
      "target": "rquqhgdy"
    },
    "style": {
      "label": "",
      "font-size": "10px",
      "width": 1,
      "color": "black",
      "line-color": "pink",
      "line-style": "solid",
      "curve-style": "bezier",
      "target-arrow-shape": "triangle",
      "target-arrow-color": "pink",
      "arrow-scale": 0.5
    }
  },
  {
    "data": {
      "id": "bhsrgota_hyjojnnn",
      "source": "bhsrgota",
      "target": "hyjojnnn"
    },
    "style": {
      "label": "",
      "font-size": "10px",
      "width": 1,
      "color": "black",
      "line-color": "pink",
      "line-style": "solid",
      "curve-style": "bezier",
      "target-arrow-shape": "triangle",
      "target-arrow-color": "pink",
      "arrow-scale": 0.5
    }
  },
  {
    "data": {
      "id": "rquqhgdy_khrjjtpg",
      "source": "rquqhgdy",
      "target": "khrjjtpg"
    },
    "style": {
      "label": "",
      "font-size": "10px",
      "width": 1,
      "color": "black",
      "line-color": "pink",
      "line-style": "solid",
      "curve-style": "bezier",
      "target-arrow-shape": "triangle",
      "target-arrow-color": "pink",
      "arrow-scale": 0.5
    }
  },
  {
    "data": {
      "id": "hyjojnnn_mjgwivhf",
      "source": "hyjojnnn",
      "target": "mjgwivhf"
    },
    "style": {
      "label": "",
      "font-size": "10px",
      "width": 1,
      "color": "black",
      "line-color": "pink",
      "line-style": "solid",
      "curve-style": "bezier",
      "target-arrow-shape": "triangle",
      "target-arrow-color": "pink",
      "arrow-scale": 0.5
    }
  },
  {
    "data": {
      "id": "hmujwccb_yqluvvlb",
      "source": "hmujwccb",
      "target": "yqluvvlb"
    },
    "style": {
      "label": "",
      "font-size": "10px",
      "width": 1,
      "color": "black",
      "line-color": "pink",
      "line-style": "solid",
      "curve-style": "bezier",
      "target-arrow-shape": "triangle",
      "target-arrow-color": "pink",
      "arrow-scale": 0.5
    }
  },
  {
    "data": {
      "id": "bhsrgota_frkbfvrl",
      "source": "bhsrgota",
      "target": "frkbfvrl"
    },
    "style": {
      "label": "",
      "font-size": "10px",
      "width": 1,
      "color": "black",
      "line-color": "pink",
      "line-style": "solid",
      "curve-style": "bezier",
      "target-arrow-shape": "triangle",
      "target-arrow-color": "pink",
      "arrow-scale": 0.5
    }
  },
  {
    "data": {
      "id": "mjgwivhf_yqluvvlb",
      "source": "mjgwivhf",
      "target": "yqluvvlb"
    },
    "style": {
      "label": "",
      "font-size": "10px",
      "width": 1,
      "color": "black",
      "line-color": "pink",
      "line-style": "solid",
      "curve-style": "bezier",
      "target-arrow-shape": "triangle",
      "target-arrow-color": "pink",
      "arrow-scale": 0.5
    }
  },
  {
    "data": {
      "id": "hyjojnnn_mjgwivhf",
      "source": "hyjojnnn",
      "target": "mjgwivhf"
    },
    "style": {
      "label": "",
      "font-size": "10px",
      "width": 1,
      "color": "black",
      "line-color": "pink",
      "line-style": "solid",
      "curve-style": "bezier",
      "target-arrow-shape": "triangle",
      "target-arrow-color": "pink",
      "arrow-scale": 0.5
    }
  },
  {
    "data": {
      "id": "hyjojnnn_khrjjtpg",
      "source": "hyjojnnn",
      "target": "khrjjtpg"
    },
    "style": {
      "label": "",
      "font-size": "10px",
      "width": 1,
      "color": "black",
      "line-color": "pink",
      "line-style": "solid",
      "curve-style": "bezier",
      "target-arrow-shape": "triangle",
      "target-arrow-color": "pink",
      "arrow-scale": 0.5
    }
  },
  {
    "data": {
      "id": "hmujwccb_bqbkmsep",
      "source": "hmujwccb",
      "target": "bqbkmsep"
    },
    "style": {
      "label": "",
      "font-size": "10px",
      "width": 1,
      "color": "black",
      "line-color": "pink",
      "line-style": "solid",
      "curve-style": "bezier",
      "target-arrow-shape": "triangle",
      "target-arrow-color": "pink",
      "arrow-scale": 0.5
    }
  },
  {
    "data": {
      "id": "bhsrgota_bqbkmsep",
      "source": "bhsrgota",
      "target": "bqbkmsep"
    },
    "style": {
      "label": "",
      "font-size": "10px",
      "width": 1,
      "color": "black",
      "line-color": "pink",
      "line-style": "solid",
      "curve-style": "bezier",
      "target-arrow-shape": "triangle",
      "target-arrow-color": "pink",
      "arrow-scale": 0.5
    }
  },
  {
    "data": {
      "id": "bhsrgota_hyjojnnn",
      "source": "bhsrgota",
      "target": "hyjojnnn"
    },
    "style": {
      "label": "",
      "font-size": "10px",
      "width": 1,
      "color": "black",
      "line-color": "pink",
      "line-style": "solid",
      "curve-style": "bezier",
      "target-arrow-shape": "triangle",
      "target-arrow-color": "pink",
      "arrow-scale": 0.5
    }
  },
  {
    "data": {
      "id": "yqluvvlb_bxntzeti",
      "source": "yqluvvlb",
      "target": "bxntzeti"
    },
    "style": {
      "label": "",
      "font-size": "10px",
      "width": 1,
      "color": "black",
      "line-color": "pink",
      "line-style": "solid",
      "curve-style": "bezier",
      "target-arrow-shape": "triangle",
      "target-arrow-color": "pink",
      "arrow-scale": 0.5
    }
  },
  {
    "data": {
      "id": "mjgwivhf_hmujwccb",
      "source": "mjgwivhf",
      "target": "hmujwccb"
    },
    "style": {
      "label": "",
      "font-size": "10px",
      "width": 1,
      "color": "black",
      "line-color": "pink",
      "line-style": "solid",
      "curve-style": "bezier",
      "target-arrow-shape": "triangle",
      "target-arrow-color": "pink",
      "arrow-scale": 0.5
    }
  },
  {
    "data": {
      "id": "bqbkmsep_khrjjtpg",
      "source": "bqbkmsep",
      "target": "khrjjtpg"
    },
    "style": {
      "label": "",
      "font-size": "10px",
      "width": 1,
      "color": "black",
      "line-color": "pink",
      "line-style": "solid",
      "curve-style": "bezier",
      "target-arrow-shape": "triangle",
      "target-arrow-color": "pink",
      "arrow-scale": 0.5
    }
  },
  {
    "data": {
      "id": "mjgwivhf_hmujwccb",
      "source": "mjgwivhf",
      "target": "hmujwccb"
    },
    "style": {
      "label": "",
      "font-size": "10px",
      "width": 1,
      "color": "black",
      "line-color": "pink",
      "line-style": "solid",
      "curve-style": "bezier",
      "target-arrow-shape": "triangle",
      "target-arrow-color": "pink",
      "arrow-scale": 0.5
    }
  },
  {
    "data": {
      "id": "hmujwccb_yqluvvlb",
      "source": "hmujwccb",
      "target": "yqluvvlb"
    },
    "style": {
      "label": "",
      "font-size": "10px",
      "width": 1,
      "color": "black",
      "line-color": "pink",
      "line-style": "solid",
      "curve-style": "bezier",
      "target-arrow-shape": "triangle",
      "target-arrow-color": "pink",
      "arrow-scale": 0.5
    }
  },
  {
    "data": {
      "id": "rquqhgdy_bxntzeti",
      "source": "rquqhgdy",
      "target": "bxntzeti"
    },
    "style": {
      "label": "",
      "font-size": "10px",
      "width": 1,
      "color": "black",
      "line-color": "pink",
      "line-style": "solid",
      "curve-style": "bezier",
      "target-arrow-shape": "triangle",
      "target-arrow-color": "pink",
      "arrow-scale": 0.5
    }
  },
  {
    "data": {
      "id": "khrjjtpg_yqluvvlb",
      "source": "khrjjtpg",
      "target": "yqluvvlb"
    },
    "style": {
      "label": "",
      "font-size": "10px",
      "width": 1,
      "color": "black",
      "line-color": "pink",
      "line-style": "solid",
      "curve-style": "bezier",
      "target-arrow-shape": "triangle",
      "target-arrow-color": "pink",
      "arrow-scale": 0.5
    }
  },
  {
    "data": {
      "id": "khrjjtpg_hyjojnnn",
      "source": "khrjjtpg",
      "target": "hyjojnnn"
    },
    "style": {
      "label": "",
      "font-size": "10px",
      "width": 1,
      "color": "black",
      "line-color": "pink",
      "line-style": "solid",
      "curve-style": "bezier",
      "target-arrow-shape": "triangle",
      "target-arrow-color": "pink",
      "arrow-scale": 0.5
    }
  },
  {
    "data": {
      "id": "mjgwivhf_hyjojnnn",
      "source": "mjgwivhf",
      "target": "hyjojnnn"
    },
    "style": {
      "label": "",
      "font-size": "10px",
      "width": 1,
      "color": "black",
      "line-color": "pink",
      "line-style": "solid",
      "curve-style": "bezier",
      "target-arrow-shape": "triangle",
      "target-arrow-color": "pink",
      "arrow-scale": 0.5
    }
  },
  {
    "data": {
      "id": "bqbkmsep_bhsrgota",
      "source": "bqbkmsep",
      "target": "bhsrgota"
    },
    "style": {
      "label": "",
      "font-size": "10px",
      "width": 1,
      "color": "black",
      "line-color": "pink",
      "line-style": "solid",
      "curve-style": "bezier",
      "target-arrow-shape": "triangle",
      "target-arrow-color": "pink",
      "arrow-scale": 0.5
    }
  },
  {
    "data": {
      "id": "yqluvvlb_bxntzeti",
      "source": "yqluvvlb",
      "target": "bxntzeti"
    },
    "style": {
      "label": "",
      "font-size": "10px",
      "width": 1,
      "color": "black",
      "line-color": "pink",
      "line-style": "solid",
      "curve-style": "bezier",
      "target-arrow-shape": "triangle",
      "target-arrow-color": "pink",
      "arrow-scale": 0.5
    }
  },
  {
    "data": {
      "id": "bhsrgota_bqbkmsep",
      "source": "bhsrgota",
      "target": "bqbkmsep"
    },
    "style": {
      "label": "",
      "font-size": "10px",
      "width": 1,
      "color": "black",
      "line-color": "pink",
      "line-style": "solid",
      "curve-style": "bezier",
      "target-arrow-shape": "triangle",
      "target-arrow-color": "pink",
      "arrow-scale": 0.5
    }
  },
  {
    "data": {
      "id": "frkbfvrl_hyjojnnn",
      "source": "frkbfvrl",
      "target": "hyjojnnn"
    },
    "style": {
      "label": "",
      "font-size": "10px",
      "width": 100,
      "color": "black",
      "line-color": "pink",
      "line-style": "solid",
      "curve-style": "bezier",
      "target-arrow-shape": "triangle",
      "target-arrow-color": "pink",
      "arrow-scale": 0.5
    }
  }
]


      `)

      console.log(dataset)
    </script>  
    <script src="core.js"></script>

    <script>
      let infoDiv = document.getElementById('info')

      let result = refreshGraph(dataset, {
        //nodeRadiusProperty: 'style.width',
        nodeColorProperty: 'style.background-color',
        // edgeThicknessProperty: 'style.width',
        mode: 'directional',

        onEdgeEnter: function(highlightedEdges, allNodes, allEdges) {
          console.log(highlightedEdges)
          return
          infoDiv.innerHTML = `
          ${highlightedEdges.length} connections between the nodes <b>${highlightedEdges[0].data.source}</b> and <b>${highlightedEdges[0].data.target}</b>:</br>
          <ul>
            ${highlightedEdges.map(ed => `<li>edge id: <b>${ed.data.id}</b></li>`).join('')}
          </ul>
          `
        },

        onEdgeLeave: function(highlightedEdges, allNodes, allEdges) {
          console.log(highlightedEdges)
          infoDiv.innerHTML = ''
        },


        onNodeEnter: function(node, inboundConnectedNodes, outboundConnectedNodes, allNodes, allEdges) {
          console.log(node, inboundConnectedNodes, outboundConnectedNodes, allNodes, allEdges)
          let nodeId = node.data.id
          

          infoDiv.innerHTML = `
          The node <b>${nodeId}</b> has ${inboundConnectedNodes.length} inbound connections from nodes: </br>
          <ul>
            ${inboundConnectedNodes.map(conn => `<li><b>${conn.from}</b> by edge <b>${conn.by}</b></li>`).join('')}
          </ul>
          </br>

          and ${outboundConnectedNodes.length} outbound connections to nodes: </br>
          <ul>
            ${outboundConnectedNodes.map(conn => `<li><b>${conn.to}</b> by edge <b>${conn.by}</b></li>`).join('')}
          </ul>
          `
        },


        onNodeLeave: function(node, inboundConnectedNodes, outboundConnectedNodes, allNodes, allEdges) {
          infoDiv.innerHTML = ''
        }, 

        ...options

      })


      document.getElementById('graph-host').appendChild(result.radialGraph)


      const searchList = document.getElementById('itemid-list')
      const inputList = document.getElementById('item-ids')
      searchList.innerHTML = ''
      Object.keys(result.itemMapper).sort().forEach((id) => {
        const item = result.itemMapper[id]
        const data = item.data
        const svg = item.svg

        let optionEl = document.createElement('option')
        optionEl.value = id
        optionEl.label = `${id} [${item.type}]`
        searchList.appendChild(optionEl)
      })

      let previouslySelectedItemId = null
      

      inputList.addEventListener('input', (evt) => {
        const itemId = evt.target.value

        if (previouslySelectedItemId) {
          let fakeEvt = new MouseEvent('mouseleave')
          result.itemMapper[previouslySelectedItemId].svg.dispatchEvent(fakeEvt)
          previouslySelectedItemId = null
        }

        if (!(itemId in result.itemMapper)) {
          return
        }

        let fakeEvt = new MouseEvent('mouseenter')
        result.itemMapper[itemId].svg.dispatchEvent(fakeEvt)
        previouslySelectedItemId = itemId

      })

    </script>
  </body>
</html>

