[base]
source = src/bbsearch
testdeps =
    mock
    pytest

[tox]
envlist =
;    check-version
;    check-packaging
    lint
    py36
    py37
    py38

;minversion = 3.1.0
;
;# ignore basepython for envs that already specify a version
;ignore_basepython_conflict = true
;indexserver =
;    default = https://bbpteam.epfl.ch/repository/devpi/simple

[testenv]
;basepython=python3.6
deps = {[base]testdeps}
commands = pytest {posargs:tests}

;[testenv:check-version]
;skip_install = true
;deps = bbp-nse-ci
;commands = do_release.py -p . check-version

;[testenv:check-packaging]
;deps =
;    wheel
;    twine
;commands =
;    python setup.py sdist bdist_wheel -d {envtmpdir}/dist
;    twine check {envtmpdir}/dist/*

[testenv:lint]
skipsdist = true
skip_install = true
deps =
    bandit
    black
    flake8
    isort
    pydocstyle
commands =
    flake8 {[base]source}
;    isort --profile black --check {[base]source}
    pydocstyle {[base]source}
;    bandit -q -r {[base]source}
;    black -q --check {[base]source}
;    black -q --check tests
    black -q --check setup.py

[testenv:format]
deps = black isort
commands =
    isort --profile black {[base]source}
    black {[base]source}
    black tests
    black setup.py

[testenv:coverage]
usedevelop = True
deps =
    {[base]testdeps}
    pytest-cov
commands =
    pytest --cov-branch --cov-report term-missing --cov-report xml --cov={[base]source} tests/

[testenv:docs]
changedir = doc
extras = docs
# set warnings as errors using the -W sphinx option
commands = make html SPHINXOPTS=-W
whitelist_externals = make
